<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Boards | CBSE Class 10</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .progress-ring { transform: rotate(-90deg); }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .task-complete { text-decoration: line-through; opacity: 0.6; }
        
        /* Mascot Owl SVG Styles */
        .mascot-owl {
            display: inline-block;
        }
        .subject-card {
            transition: all 0.3s ease;
        }
        .subject-card:not(.disabled):hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .subject-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Theme Variables - Default (Indigo/Purple) */
        :root {
            --primary-50: #eef2ff;
            --primary-100: #e0e7ff;
            --primary-200: #c7d2fe;
            --primary-500: #6366f1;
            --primary-600: #4f46e5;
            --primary-700: #4338ca;
            --gradient-start: #6366f1;
            --gradient-end: #9333ea;
        }
        
        /* Theme Overrides */
        body.theme-green {
            --primary-50: #ecfdf5;
            --primary-100: #d1fae5;
            --primary-200: #a7f3d0;
            --primary-500: #10b981;
            --primary-600: #059669;
            --primary-700: #047857;
            --gradient-start: #10b981;
            --gradient-end: #059669;
        }
        
        body.theme-purple {
            --primary-50: #f5f3ff;
            --primary-100: #ede9fe;
            --primary-200: #ddd6fe;
            --primary-500: #8b5cf6;
            --primary-600: #7c3aed;
            --primary-700: #6d28d9;
            --gradient-start: #8b5cf6;
            --gradient-end: #d946ef;
        }
        
        body.theme-orange {
            --primary-50: #fff7ed;
            --primary-100: #ffedd5;
            --primary-200: #fed7aa;
            --primary-500: #f97316;
            --primary-600: #ea580c;
            --primary-700: #c2410c;
            --gradient-start: #f97316;
            --gradient-end: #db2777;
        }

        /* Apply Variables */
        .bg-indigo-50, .bg-indigo-100, .bg-indigo-500, .bg-indigo-600 { background-color: var(--primary-600) !important; }
        .bg-indigo-50 { background-color: var(--primary-50) !important; }
        .bg-indigo-100 { background-color: var(--primary-100) !important; }
        .bg-indigo-500 { background-color: var(--primary-500) !important; }
        
        .text-indigo-500, .text-indigo-600, .text-indigo-700 { color: var(--primary-600) !important; }
        .text-indigo-700 { color: var(--primary-700) !important; }
        
        .border-indigo-200 { border-color: var(--primary-200) !important; }
        .border-indigo-500 { border-color: var(--primary-500) !important; }
        
        .focus\:ring-indigo-500:focus { --tw-ring-color: var(--primary-500) !important; }
        .focus\:border-indigo-500:focus { border-color: var(--primary-500) !important; }
        
        /* Gradients */
        .from-indigo-500 { --tw-gradient-from: var(--gradient-start) !important; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to) !important; }
        .to-purple-600 { --tw-gradient-to: var(--gradient-end) !important; }
        
        /* Specific overrides for tab buttons */
        .tab-btn.bg-indigo-100 { background-color: var(--primary-100) !important; color: var(--primary-700) !important; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <!-- Subject Selection Page -->
    <div id="subjectSelectionPage" class="min-h-screen flex flex-col items-center justify-center p-6">
        <!-- Auth Header -->
        <div class="fixed top-4 right-4">
            <div id="authHeaderArea"></div>
        </div>

        <div class="text-center mb-12">
            <!-- Mascot Logo -->
            <div class="flex justify-center mb-6">
                <div class="w-24 h-24 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-xl">
                    <svg class="mascot-owl w-16 h-16 text-white" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Owl Body -->
                        <ellipse cx="32" cy="38" rx="18" ry="16" fill="currentColor" opacity="0.9"/>
                        <!-- Owl Head -->
                        <circle cx="32" cy="24" r="14" fill="currentColor"/>
                        <!-- Left Eye Circle -->
                        <circle cx="26" cy="24" r="6" fill="#1e1b4b"/>
                        <circle cx="26" cy="24" r="4" fill="#fef3c7"/>
                        <circle cx="27" cy="23" r="2" fill="#1e1b4b"/>
                        <circle cx="28" cy="22" r="0.8" fill="white"/>
                        <!-- Right Eye Circle -->
                        <circle cx="38" cy="24" r="6" fill="#1e1b4b"/>
                        <circle cx="38" cy="24" r="4" fill="#fef3c7"/>
                        <circle cx="39" cy="23" r="2" fill="#1e1b4b"/>
                        <circle cx="40" cy="22" r="0.8" fill="white"/>
                        <!-- Beak -->
                        <path d="M32 28 L29 32 L32 31 L35 32 Z" fill="#f59e0b"/>
                        <!-- Ear Tufts -->
                        <path d="M20 14 L22 20 L18 18 Z" fill="currentColor"/>
                        <path d="M44 14 L42 20 L46 18 Z" fill="currentColor"/>
                        <!-- Graduation Cap -->
                        <rect x="22" y="10" width="20" height="3" fill="#1e1b4b" rx="1"/>
                        <polygon points="32,6 22,11 32,13 42,11" fill="#1e1b4b"/>
                        <circle cx="32" cy="9" r="1.5" fill="#f59e0b"/>
                    </svg>
                </div>
            </div>
            <h1 class="text-3xl font-bold text-slate-800 mb-2">Learn Boards</h1>
            <p class="text-slate-500">CBSE Class 10 Board Exam Preparation</p>
        </div>

        <div class="grid md:grid-cols-3 gap-6 max-w-4xl w-full">
            <!-- Science Card (Active) -->
            <div onclick="enterSubject('science')" class="subject-card bg-white rounded-2xl p-6 border-2 border-transparent hover:border-indigo-500 cursor-pointer shadow-sm">
                <div class="w-14 h-14 bg-indigo-100 rounded-xl flex items-center justify-center mb-4">
                    <span class="text-3xl">üî¨</span>
                </div>
                <h3 class="font-bold text-xl text-slate-800 mb-2">Science</h3>
                <p class="text-sm text-slate-500 mb-4">Physics, Chemistry & Biology preparation with structured study plans</p>
                <div class="flex items-center gap-2 text-indigo-600 font-medium text-sm">
                    <span>Start Learning</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </div>
            </div>

            <!-- Maths Card (Coming Soon) -->
            <div class="subject-card disabled bg-white rounded-2xl p-6 border-2 border-slate-200 shadow-sm">
                <div class="w-14 h-14 bg-slate-100 rounded-xl flex items-center justify-center mb-4">
                    <span class="text-3xl grayscale">üìê</span>
                </div>
                <h3 class="font-bold text-xl text-slate-400 mb-2">Mathematics</h3>
                <p class="text-sm text-slate-400 mb-4">Complete maths preparation with practice problems and solutions</p>
                <div class="flex items-center gap-2 text-slate-400 font-medium text-sm">
                    <span class="px-3 py-1 bg-slate-100 rounded-full text-xs">Coming Soon</span>
                </div>
            </div>

            <!-- Social Science Card (Coming Soon) -->
            <div class="subject-card disabled bg-white rounded-2xl p-6 border-2 border-slate-200 shadow-sm">
                <div class="w-14 h-14 bg-slate-100 rounded-xl flex items-center justify-center mb-4">
                    <span class="text-3xl grayscale">üåç</span>
                </div>
                <h3 class="font-bold text-xl text-slate-400 mb-2">Social Science</h3>
                <p class="text-sm text-slate-400 mb-4">History, Geography, Civics & Economics comprehensive prep</p>
                <div class="flex items-center gap-2 text-slate-400 font-medium text-sm">
                    <span class="px-3 py-1 bg-slate-100 rounded-full text-xs">Coming Soon</span>
                </div>
            </div>
        </div>

        <p class="text-xs text-slate-400 mt-12">Made for focused, distraction-free board exam preparation</p>
    </div>

    <!-- Main Science App (Hidden Initially) -->
    <div id="scienceApp" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white sticky top-0 z-50 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-md">
                            <!-- Full Mascot in Header -->
                            <svg class="mascot-owl w-8 h-8 text-white" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <ellipse cx="32" cy="38" rx="18" ry="16" fill="currentColor" opacity="0.9"/>
                                <circle cx="32" cy="24" r="14" fill="currentColor"/>
                                <circle cx="26" cy="24" r="6" fill="#1e1b4b"/>
                                <circle cx="26" cy="24" r="4" fill="#fef3c7"/>
                                <circle cx="27" cy="23" r="2" fill="#1e1b4b"/>
                                <circle cx="28" cy="22" r="0.8" fill="white"/>
                                <circle cx="38" cy="24" r="6" fill="#1e1b4b"/>
                                <circle cx="38" cy="24" r="4" fill="#fef3c7"/>
                                <circle cx="39" cy="23" r="2" fill="#1e1b4b"/>
                                <circle cx="40" cy="22" r="0.8" fill="white"/>
                                <path d="M32 28 L29 32 L32 31 L35 32 Z" fill="#f59e0b"/>
                                <path d="M20 14 L22 20 L18 18 Z" fill="currentColor"/>
                                <path d="M44 14 L42 20 L46 18 Z" fill="currentColor"/>
                                <rect x="22" y="10" width="20" height="3" fill="#1e1b4b" rx="1"/>
                                <polygon points="32,6 22,11 32,13 42,11" fill="#1e1b4b"/>
                                <circle cx="32" cy="9" r="1.5" fill="#f59e0b"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="font-bold text-lg">Learn Boards</h1>
                            <p class="text-xs text-slate-300">Science ‚Ä¢ CBSE Class 10</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right hidden sm:block">
                            <p class="text-xs text-slate-300">Days to Exam</p>
                            <p id="daysLeft" class="text-2xl font-bold text-amber-400">--</p>
                        </div>
                        <button onclick="goToSubjectSelection()" class="p-2 hover:bg-white/10 rounded-lg transition" title="Change Subject">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                            </svg>
                        </button>
                        <!-- Account Button -->
                        <button onclick="openAccountModal()" class="p-2 hover:bg-white/10 rounded-lg transition" title="Account">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </button>
                        <button onclick="openSettings()" class="p-2 hover:bg-white/10 rounded-lg transition">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-white border-b sticky top-[72px] z-40 shadow-sm">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex gap-1 overflow-x-auto scrollbar-hide py-2">
                    <button onclick="showTab('dashboard')" class="tab-btn active px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="dashboard">üìä Today</button>
                    <button onclick="showTab('chapters')" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="chapters">üìö Chapters</button>
                    <button onclick="showTab('session')" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="session">‚è±Ô∏è Study</button>
                    <button onclick="showTab('papers')" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="papers">üìÑ Papers</button>
                    <button onclick="showTab('performance')" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="performance">üìà Progress</button>
                    <button onclick="showTab('rules')" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition" data-tab="rules">üìã Rules</button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-4 py-6">
            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content">
                <!-- Maths Load Selector -->
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-5 mb-6 text-white shadow-lg">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                        <div>
                            <h2 class="font-bold text-lg flex items-center gap-2">
                                <span class="text-2xl">‚ö°</span> Today's Maths Load
                            </h2>
                            <p class="text-sm text-white/80 mt-1">This adjusts your Science intensity automatically</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="setMathsLoad('light')" class="maths-btn px-4 py-2 rounded-lg text-sm font-medium transition bg-white/20 hover:bg-white/30" data-load="light">üü¢ Light</button>
                            <button onclick="setMathsLoad('medium')" class="maths-btn px-4 py-2 rounded-lg text-sm font-medium transition bg-white/20 hover:bg-white/30" data-load="medium">üü° Medium</button>
                            <button onclick="setMathsLoad('heavy')" class="maths-btn px-4 py-2 rounded-lg text-sm font-medium transition bg-white/20 hover:bg-white/30" data-load="heavy">üî¥ Heavy</button>
                        </div>
                    </div>
                    <div id="scienceAllocation" class="mt-4 p-3 bg-white/10 rounded-xl">
                        <p class="text-sm">Select your Maths load to see today's Science allocation</p>
                    </div>
                </div>

                <!-- Today's Plan -->
                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Main Tasks -->
                    <div class="lg:col-span-2 space-y-4">
                        <div class="bg-white rounded-2xl p-5 shadow-sm card-hover">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-lg text-slate-800">üìå Today's Tasks</h3>
                                <button onclick="generateDailyPlan()" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">Regenerate</button>
                            </div>
                            <div id="dailyTasks" class="space-y-3">
                                <p class="text-slate-500 text-sm">Set your Maths load and exam date to generate tasks</p>
                            </div>
                        </div>

                        <!-- Current Chapter Focus -->
                        <div class="bg-white rounded-2xl p-5 shadow-sm card-hover">
                            <h3 class="font-bold text-lg text-slate-800 mb-4">üéØ Current Focus</h3>
                            <div id="currentFocus" class="text-slate-500 text-sm">
                                Complete setup to see your focus chapter
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar Stats -->
                    <div class="space-y-4">
                        <!-- Progress Ring -->
                        <div class="bg-white rounded-2xl p-5 shadow-sm card-hover text-center">
                            <h3 class="font-bold text-slate-800 mb-4">Syllabus Progress</h3>
                            <div class="relative inline-block">
                                <svg class="w-32 h-32" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="40" stroke="#e2e8f0" stroke-width="8" fill="none"/>
                                    <circle id="progressRing" class="progress-ring" cx="50" cy="50" r="40" stroke="#6366f1" stroke-width="8" fill="none" stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="progressPercent" class="text-3xl font-bold text-slate-800">0%</span>
                                </div>
                            </div>
                            <p class="text-sm text-slate-500 mt-2"><span id="chaptersComplete">0</span>/13 Chapters</p>
                        </div>

                        <!-- Quick Stats -->
                        <div class="bg-white rounded-2xl p-5 shadow-sm card-hover">
                            <h3 class="font-bold text-slate-800 mb-4">Today's Stats</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">Study Time</span>
                                    <span id="todayStudyTime" class="font-bold text-slate-800">0 min</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">Questions Done</span>
                                    <span id="todayQuestions" class="font-bold text-slate-800">0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">Accuracy</span>
                                    <span id="todayAccuracy" class="font-bold text-slate-800">--%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Streak -->
                        <div class="bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl p-5 shadow-sm text-white">
                            <div class="flex items-center gap-3">
                                <span class="text-4xl">üî•</span>
                                <div>
                                    <p class="text-sm text-white/80">Current Streak</p>
                                    <p id="streakCount" class="text-3xl font-bold">0 days</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chapters Tab -->
            <div id="tab-chapters" class="tab-content hidden">
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <!-- Physics -->
                    <div class="bg-blue-50 rounded-2xl p-5 border-2 border-blue-200">
                        <h3 class="font-bold text-blue-800 text-lg mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center text-white text-sm">‚ö°</span>
                            Physics
                        </h3>
                        <div id="physicsChapters" class="space-y-2"></div>
                    </div>

                    <!-- Chemistry -->
                    <div class="bg-green-50 rounded-2xl p-5 border-2 border-green-200">
                        <h3 class="font-bold text-green-800 text-lg mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center text-white text-sm">üß™</span>
                            Chemistry
                        </h3>
                        <div id="chemistryChapters" class="space-y-2"></div>
                    </div>

                    <!-- Biology -->
                    <div class="bg-purple-50 rounded-2xl p-5 border-2 border-purple-200">
                        <h3 class="font-bold text-purple-800 text-lg mb-4 flex items-center gap-2">
                            <span class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center text-white text-sm">üß¨</span>
                            Biology
                        </h3>
                        <div id="biologyChapters" class="space-y-2"></div>
                    </div>
                </div>

                <!-- Chapter Detail Modal -->
                <div id="chapterModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div id="chapterModalContent"></div>
                    </div>
                </div>
            </div>

            <!-- Study Session Tab -->
            <div id="tab-session" class="tab-content hidden">
                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Timer -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-6 text-center">Study Timer</h3>
                        <div class="text-center">
                            <div id="timerDisplay" class="text-6xl font-bold text-slate-800 font-mono mb-6">25:00</div>
                            <div class="flex justify-center gap-3 mb-6">
                                <button onclick="setTimer(25)" class="timer-preset px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium transition">25 min</button>
                                <button onclick="setTimer(45)" class="timer-preset px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium transition">45 min</button>
                                <button onclick="setTimer(60)" class="timer-preset px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium transition">60 min</button>
                            </div>
                            <div class="flex justify-center gap-3">
                                <button onclick="startTimer()" id="startBtn" class="px-8 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl font-medium transition">‚ñ∂ Start</button>
                                <button onclick="pauseTimer()" id="pauseBtn" class="hidden px-8 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-medium transition">‚è∏ Pause</button>
                                <button onclick="resetTimer()" class="px-8 py-3 bg-slate-200 hover:bg-slate-300 rounded-xl font-medium transition">‚Ü∫ Reset</button>
                            </div>
                        </div>
                    </div>

                    <!-- Current Task -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-4">Current Task</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-600 mb-2">What are you studying?</label>
                            <select id="sessionChapter" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">Select Chapter</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-600 mb-2">Activity Type</label>
                            <select id="sessionActivity" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="ncert">üìñ NCERT Reading (First-time only)</option>
                                <option value="oswal">üìù Oswal Practice</option>
                                <option value="pyq">üìú PYQ Solving</option>
                                <option value="revision">üîÑ Notes Revision</option>
                                <option value="sample">üìã Sample Paper</option>
                            </select>
                        </div>
                        <div id="resourceWarning" class="hidden p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm mb-4">
                        </div>
                        <div id="resourceTip" class="p-4 bg-indigo-50 border border-indigo-200 rounded-xl text-indigo-700 text-sm">
                            <strong>üí° Tip:</strong> Select an activity to see resource guidelines
                        </div>
                    </div>

                    <!-- Session Log -->
                    <div class="lg:col-span-2 bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-4">Log Questions Practiced</h3>
                        <div class="grid sm:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-2">Questions Attempted</label>
                                <input type="number" id="questionsAttempted" min="0" value="0" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-2">Correct Answers</label>
                                <input type="number" id="questionsCorrect" min="0" value="0" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-2">Difficulty Faced</label>
                                <select id="difficultyLevel" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                                    <option value="easy">üòä Easy</option>
                                    <option value="medium">üòê Medium</option>
                                    <option value="hard">üòì Hard</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="logSession()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-medium transition">
                            ‚úì Log This Session
                        </button>
                    </div>
                </div>
            </div>

            <!-- Board Papers Tab (NEW) -->
            <div id="tab-papers" class="tab-content hidden">
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <div class="flex items-center gap-4 mb-6">
                            <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
                                <span class="text-2xl">üìÑ</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-xl text-slate-800">Board Paper Tracker</h3>
                                <p class="text-sm text-slate-500">Track your CBSE Science board paper practice</p>
                            </div>
                        </div>

                        <div id="boardPapersList" class="space-y-3">
                            <!-- Papers will be rendered here -->
                        </div>

                        <div class="mt-6 pt-6 border-t">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-slate-600">Papers Completed</span>
                                <span id="papersCompleted" class="font-bold text-indigo-600">0 / 10</span>
                            </div>
                            <div class="mt-2 h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div id="papersProgressBar" class="h-full bg-indigo-500 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Empty State with Mascot -->
                    <div id="papersEmptyHint" class="hidden mt-6 text-center py-8">
                        <div class="inline-flex w-16 h-16 bg-slate-100 rounded-2xl items-center justify-center mb-4">
                            <svg class="mascot-owl w-10 h-10 text-slate-400" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="32" cy="28" r="14" fill="currentColor"/>
                                <circle cx="26" cy="27" r="4" fill="#64748b"/>
                                <circle cx="26" cy="27" r="2.5" fill="#e2e8f0"/>
                                <circle cx="27" cy="26" r="1.2" fill="#64748b"/>
                                <circle cx="38" cy="27" r="4" fill="#64748b"/>
                                <circle cx="38" cy="27" r="2.5" fill="#e2e8f0"/>
                                <circle cx="39" cy="26" r="1.2" fill="#64748b"/>
                                <path d="M32 31 L30 34 L32 33 L34 34 Z" fill="#94a3b8"/>
                            </svg>
                        </div>
                        <p class="text-slate-500 text-sm">Start practicing board papers to track your progress</p>
                    </div>
                </div>
            </div>

            <!-- Performance Tab -->
            <div id="tab-performance" class="tab-content hidden">
                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Weekly Overview -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-4">This Week</h3>
                        <div id="weeklyChart" class="grid grid-cols-7 gap-2">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- Subject-wise Progress -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-4">Subject Progress</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-slate-600">Physics</span>
                                    <span id="physicsProgress" class="font-medium">0%</span>
                                </div>
                                <div class="h-3 bg-slate-100 rounded-full overflow-hidden">
                                    <div id="physicsBar" class="h-full bg-blue-500 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-slate-600">Chemistry</span>
                                    <span id="chemistryProgress" class="font-medium">0%</span>
                                </div>
                                <div class="h-3 bg-slate-100 rounded-full overflow-hidden">
                                    <div id="chemistryBar" class="h-full bg-green-500 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-slate-600">Biology</span>
                                    <span id="biologyProgress" class="font-medium">0%</span>
                                </div>
                                <div class="h-3 bg-slate-100 rounded-full overflow-hidden">
                                    <div id="biologyBar" class="h-full bg-purple-500 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Sessions -->
                    <div class="lg:col-span-2 bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-4">Recent Sessions</h3>
                        <div id="recentSessions" class="space-y-3 max-h-80 overflow-y-auto">
                            <p class="text-slate-500 text-sm">No sessions logged yet</p>
                        </div>
                    </div>

                    <!-- Weak Topics -->
                    <div class="lg:col-span-2 bg-red-50 rounded-2xl p-6 border-2 border-red-200">
                        <h3 class="font-bold text-xl text-red-800 mb-4">‚ö†Ô∏è Topics Needing Attention</h3>
                        <div id="weakTopics" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3">
                            <p class="text-red-600 text-sm">Complete some practice sessions to identify weak areas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rules Tab -->
            <div id="tab-rules" class="tab-content hidden">
                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Resource Rules -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-4">üìö Resource Usage Rules</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-xl border-l-4 border-blue-500">
                                <h4 class="font-bold text-blue-800">NCERT Textbook</h4>
                                <p class="text-sm text-blue-700 mt-1">‚úì First-time concept learning ONLY</p>
                                <p class="text-sm text-blue-700">‚úó Never for revision or practice</p>
                            </div>
                            <div class="p-4 bg-green-50 rounded-xl border-l-4 border-green-500">
                                <h4 class="font-bold text-green-800">Oswal Question Bank</h4>
                                <p class="text-sm text-green-700 mt-1">‚úì Main practice engine</p>
                                <p class="text-sm text-green-700">‚úì Chapter-wise ‚Üí Topic-wise ‚Üí PYQs</p>
                                <p class="text-sm text-green-700">‚úì Includes 2016-2025 papers</p>
                            </div>
                            <div class="p-4 bg-amber-50 rounded-xl border-l-4 border-amber-500">
                                <h4 class="font-bold text-amber-800">Sample Papers</h4>
                                <p class="text-sm text-amber-700 mt-1">‚úì ONLY after full syllabus completion</p>
                                <p class="text-sm text-amber-700">‚úì Timed, exam-mode only</p>
                                <p class="text-sm text-amber-700">‚úó Never use as practice material</p>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-xl border-l-4 border-purple-500">
                                <h4 class="font-bold text-purple-800">Personal Notes</h4>
                                <p class="text-sm text-purple-700 mt-1">‚úì Revision only</p>
                                <p class="text-sm text-purple-700">‚úó Never for first-time learning</p>
                            </div>
                            <div class="p-4 bg-slate-50 rounded-xl border-l-4 border-slate-500">
                                <h4 class="font-bold text-slate-800">SuperCoP Website</h4>
                                <p class="text-sm text-slate-700 mt-1">‚úì Answer presentation reference</p>
                                <p class="text-sm text-slate-700">‚úì Marking scheme understanding</p>
                            </div>
                        </div>
                    </div>

                    <!-- Study Principles -->
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-xl text-slate-800 mb-4">üéØ Core Principles</h3>
                        <div class="space-y-4">
                            <div class="flex gap-3 p-4 bg-slate-50 rounded-xl">
                                <span class="text-2xl">üö´</span>
                                <div>
                                    <h4 class="font-bold text-slate-800">No Passive Reading</h4>
                                    <p class="text-sm text-slate-600">Reading without practice = wasted time. Always have a pen ready.</p>
                                </div>
                            </div>
                            <div class="flex gap-3 p-4 bg-slate-50 rounded-xl">
                                <span class="text-2xl">‚öñÔ∏è</span>
                                <div>
                                    <h4 class="font-bold text-slate-800">Balance is Key</h4>
                                    <p class="text-sm text-slate-600">Maths is priority. Science adapts around it, not the other way.</p>
                                </div>
                            </div>
                            <div class="flex gap-3 p-4 bg-slate-50 rounded-xl">
                                <span class="text-2xl">üîÑ</span>
                                <div>
                                    <h4 class="font-bold text-slate-800">Spaced Repetition</h4>
                                    <p class="text-sm text-slate-600">Revisit topics at Day 1, 3, 7, 14 intervals.</p>
                                </div>
                            </div>
                            <div class="flex gap-3 p-4 bg-slate-50 rounded-xl">
                                <span class="text-2xl">üìä</span>
                                <div>
                                    <h4 class="font-bold text-slate-800">Track Everything</h4>
                                    <p class="text-sm text-slate-600">What gets measured gets improved. Log all sessions.</p>
                                </div>
                            </div>
                            <div class="flex gap-3 p-4 bg-slate-50 rounded-xl">
                                <span class="text-2xl">üéØ</span>
                                <div>
                                    <h4 class="font-bold text-slate-800">Weak Areas First</h4>
                                    <p class="text-sm text-slate-600">Attack weaknesses before polishing strengths.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Syllabus Reference -->
                    <div class="lg:col-span-2 bg-slate-800 rounded-2xl p-6 text-white">
                        <h3 class="font-bold text-xl mb-4">üìã Official Syllabus (No Deletions)</h3>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <h4 class="font-bold text-blue-400 mb-2">Physics (4 Chapters)</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Electricity</li>
                                    <li>‚Ä¢ Magnetic Effects of Electric Current</li>
                                    <li>‚Ä¢ Light ‚Äì Reflection and Refraction</li>
                                    <li>‚Ä¢ The Human Eye and Colourful World</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-green-400 mb-2">Chemistry (4 Chapters)</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Chemical Reactions and Equations</li>
                                    <li>‚Ä¢ Acids, Bases and Salts</li>
                                    <li>‚Ä¢ Metals and Non-metals</li>
                                    <li>‚Ä¢ Carbon and its Compounds</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-purple-400 mb-2">Biology (5 Chapters)</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Life Processes</li>
                                    <li>‚Ä¢ Control and Coordination</li>
                                    <li>‚Ä¢ How do Organisms Reproduce</li>
                                    <li>‚Ä¢ Heredity and Evolution</li>
                                    <li>‚Ä¢ Environment</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-slate-800">‚öôÔ∏è Settings</h3>
                <button onclick="closeSettings()" class="text-slate-400 hover:text-slate-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="space-y-4">
                <!-- Theme Selection -->
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Color Theme</label>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="setTheme('default')" class="h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 ring-2 ring-offset-2 ring-transparent hover:ring-indigo-300 transition" title="Default Blue"></button>
                        <button onclick="setTheme('green')" class="h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 ring-2 ring-offset-2 ring-transparent hover:ring-emerald-300 transition" title="Nature Green"></button>
                        <button onclick="setTheme('purple')" class="h-10 rounded-lg bg-gradient-to-br from-violet-500 to-fuchsia-600 ring-2 ring-offset-2 ring-transparent hover:ring-violet-300 transition" title="Royal Purple"></button>
                        <button onclick="setTheme('orange')" class="h-10 rounded-lg bg-gradient-to-br from-orange-500 to-pink-600 ring-2 ring-offset-2 ring-transparent hover:ring-orange-300 transition" title="Sunset Orange"></button>
                    </div>
                </div>

                <!-- Subject Switching -->
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Current Subject</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="switchSubject('science')" class="px-3 py-2 rounded-lg bg-indigo-100 text-indigo-700 font-medium text-sm border-2 border-indigo-500">Science</button>
                        <button onclick="switchSubject('maths')" class="px-3 py-2 rounded-lg bg-slate-50 text-slate-500 font-medium text-sm border-2 border-transparent hover:bg-slate-100">Maths</button>
                        <button onclick="switchSubject('social')" class="px-3 py-2 rounded-lg bg-slate-50 text-slate-500 font-medium text-sm border-2 border-transparent hover:bg-slate-100">Social</button>
                    </div>
                    <p id="subjectSwitchError" class="hidden text-xs text-red-500 mt-2 font-medium flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        Coming Soon! Only Science is available.
                    </p>
                </div>

                <div class="h-px bg-slate-200 my-2"></div>

                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Exam Date</label>
                    <input type="date" id="examDate" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Daily Science Hours (Max)</label>
                    <select id="maxHours" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                        <option value="1">1 hour</option>
                        <option value="1.5" selected>1.5 hours</option>
                        <option value="2">2 hours</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Syllabus Completion Status</label>
                    <select id="syllabusStatus" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                        <option value="incomplete">First cycle incomplete</option>
                        <option value="complete">First cycle complete</option>
                    </select>
                </div>
                <button onclick="saveSettings()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-medium transition mt-4">
                    Save Settings
                </button>
                <button onclick="resetAllData()" class="w-full py-3 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl font-medium transition">
                    Reset All Data
                </button>
            </div>
        </div>
    </div>

    <!-- Account Modal -->
    <div id="accountModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-slate-800">üë§ Account</h3>
                <button onclick="closeAccountModal()" class="text-slate-400 hover:text-slate-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Not Signed In View -->
            <div id="authNotSignedIn">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <svg class="mascot-owl w-12 h-12 text-white" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <ellipse cx="32" cy="38" rx="18" ry="16" fill="currentColor" opacity="0.9"/>
                            <circle cx="32" cy="24" r="14" fill="currentColor"/>
                            <circle cx="26" cy="24" r="6" fill="#1e1b4b"/>
                            <circle cx="26" cy="24" r="4" fill="#fef3c7"/>
                            <circle cx="27" cy="23" r="2" fill="#1e1b4b"/>
                            <circle cx="28" cy="22" r="0.8" fill="white"/>
                            <circle cx="38" cy="24" r="6" fill="#1e1b4b"/>
                            <circle cx="38" cy="24" r="4" fill="#fef3c7"/>
                            <circle cx="39" cy="23" r="2" fill="#1e1b4b"/>
                            <circle cx="40" cy="22" r="0.8" fill="white"/>
                            <path d="M32 28 L29 32 L32 31 L35 32 Z" fill="#f59e0b"/>
                            <rect x="22" y="10" width="20" height="3" fill="#1e1b4b" rx="1"/>
                            <polygon points="32,6 22,11 32,13 42,11" fill="#1e1b4b"/>
                            <circle cx="32" cy="9" r="1.5" fill="#f59e0b"/>
                        </svg>
                    </div>
                    <p class="text-slate-600 text-sm">Sign in to save your progress across devices</p>
                </div>

                <!-- Sign In Form -->
                <div id="signInForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-2">Email</label>
                            <input type="email" id="authEmail" placeholder="your@email.com" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-2">Password</label>
                            <input type="password" id="authPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div id="authNameField" class="hidden">
                            <label class="block text-sm font-medium text-slate-600 mb-2">Name</label>
                            <input type="text" id="authName" placeholder="Your name" class="w-full p-3 border rounded-xl text-slate-800 focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div id="authError" class="hidden p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm"></div>
                        <button onclick="handleAuth()" id="authSubmitBtn" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-medium transition">
                            Sign In
                        </button>
                        <button onclick="toggleAuthMode()" id="authToggleBtn" class="w-full py-3 text-indigo-600 hover:text-indigo-700 font-medium text-sm">
                            Don't have an account? Sign Up
                        </button>
                    </div>
                </div>
            </div>

            <!-- Signed In View -->
            <div id="authSignedIn" class="hidden">
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span id="userInitial" class="text-3xl font-bold text-white">U</span>
                    </div>
                    <h4 id="userName" class="font-bold text-lg text-slate-800">User</h4>
                    <p id="userEmail" class="text-sm text-slate-500">email@example.com</p>
                </div>
                
                <div class="p-4 bg-green-50 border border-green-200 rounded-xl mb-4">
                    <div class="flex items-center gap-2 text-green-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span class="font-medium">Progress synced</span>
                    </div>
                    <p class="text-sm text-green-600 mt-1">Your data is saved to your account</p>
                </div>

                <div class="space-y-3">
                    <button onclick="syncData()" class="w-full py-3 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-xl font-medium transition flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Sync Now
                    </button>
                    <button onclick="signOut()" class="w-full py-3 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl font-medium transition">
                        Sign Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed bottom-4 right-4 bg-slate-800 text-white px-6 py-3 rounded-xl shadow-lg z-50 transition-all">
    </div>

    <script>
        // ==================== DATA STRUCTURES ====================
        const CHAPTERS = {
            physics: [
                { id: 'electricity', name: 'Electricity', weight: 8, topics: ['Ohm\'s Law', 'Resistance', 'Series & Parallel', 'Power & Energy', 'Numericals'] },
                { id: 'magnetic', name: 'Magnetic Effects of Electric Current', weight: 6, topics: ['Magnetic Field', 'Fleming\'s Rules', 'Electric Motor', 'Electromagnetic Induction', 'Generator'] },
                { id: 'light', name: 'Light ‚Äì Reflection and Refraction', weight: 8, topics: ['Reflection', 'Spherical Mirrors', 'Refraction', 'Lenses', 'Power of Lens'] },
                { id: 'human-eye', name: 'The Human Eye and Colourful World', weight: 5, topics: ['Human Eye', 'Defects of Vision', 'Atmospheric Refraction', 'Dispersion', 'Scattering'] }
            ],
            chemistry: [
                { id: 'chemical-reactions', name: 'Chemical Reactions and Equations', weight: 5, topics: ['Balancing Equations', 'Types of Reactions', 'Oxidation-Reduction', 'Corrosion', 'Rancidity'] },
                { id: 'acids-bases', name: 'Acids, Bases and Salts', weight: 7, topics: ['Properties', 'pH Scale', 'Indicators', 'Salts', 'Preparation Methods'] },
                { id: 'metals', name: 'Metals and Non-metals', weight: 6, topics: ['Physical Properties', 'Chemical Properties', 'Reactivity Series', 'Extraction', 'Corrosion'] },
                { id: 'carbon', name: 'Carbon and its Compounds', weight: 8, topics: ['Bonding', 'Hydrocarbons', 'Functional Groups', 'Nomenclature', 'Chemical Properties'] }
            ],
            biology: [
                { id: 'life-processes', name: 'Life Processes', weight: 8, topics: ['Nutrition', 'Respiration', 'Transportation', 'Excretion'] },
                { id: 'control', name: 'Control and Coordination', weight: 6, topics: ['Nervous System', 'Reflex Arc', 'Brain', 'Hormones', 'Plant Hormones'] },
                { id: 'reproduction', name: 'How do Organisms Reproduce', weight: 7, topics: ['Asexual', 'Sexual Reproduction', 'Human Reproduction', 'Reproductive Health'] },
                { id: 'heredity', name: 'Heredity and Evolution', weight: 6, topics: ['Mendel\'s Laws', 'Sex Determination', 'Evolution', 'Speciation', 'Human Evolution'] },
                { id: 'environment', name: 'Environment', weight: 4, topics: ['Ecosystem', 'Food Chain', 'Ozone Layer', 'Waste Management'] }
            ]
        };

        // Board Papers Data
        const BOARD_PAPERS = [
            { year: 2016 },
            { year: 2017 },
            { year: 2018 },
            { year: 2019 },
            { year: 2020 },
            { year: 2021 },
            { year: 2022 },
            { year: 2023 },
            { year: 2024 },
            { year: 2025 }
        ];

        // ==================== STATE MANAGEMENT ====================
        let state = {
            examDate: null,
            maxHours: 1.5,
            mathsLoad: 'medium',
            syllabusComplete: false,
            chapters: {},
            sessions: [],
            streak: 0,
            lastStudyDate: null,
            todayStats: { time: 0, questions: 0, correct: 0 },
            boardPapers: {},
            theme: 'default'
        };

        // Timer state
        let timerState = {
            duration: 25 * 60,
            remaining: 25 * 60,
            running: false,
            interval: null
        };

        // Auth state
        let authState = {
            isSignedIn: false,
            user: null,
            isSignUpMode: false
        };

        // ==================== AUTHENTICATION ====================
        function loadAuthState() {
            const savedAuth = localStorage.getItem('learnBoardsAuth');
            if (savedAuth) {
                const parsed = JSON.parse(savedAuth);
                authState.isSignedIn = true;
                authState.user = parsed;
                // Load user-specific data
                loadUserData(parsed.email);
            }
            updateAuthUI();
        }

        function updateAuthUI() {
            const headerArea = document.getElementById('authHeaderArea');
            
            if (authState.isSignedIn) {
                headerArea.innerHTML = `
                    <button onclick="openAccountModal()" class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm hover:shadow-md transition">
                        <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-sm">${authState.user.name.charAt(0).toUpperCase()}</span>
                        </div>
                        <span class="text-sm font-medium text-slate-700">${authState.user.name}</span>
                    </button>
                `;
                document.getElementById('authNotSignedIn').classList.add('hidden');
                document.getElementById('authSignedIn').classList.remove('hidden');
                document.getElementById('userName').textContent = authState.user.name;
                document.getElementById('userEmail').textContent = authState.user.email;
                document.getElementById('userInitial').textContent = authState.user.name.charAt(0).toUpperCase();
            } else {
                headerArea.innerHTML = `
                    <button onclick="openAccountModal()" class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm hover:shadow-md transition">
                        <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span class="text-sm font-medium text-slate-700">Sign In</span>
                    </button>
                `;
                document.getElementById('authNotSignedIn').classList.remove('hidden');
                document.getElementById('authSignedIn').classList.add('hidden');
            }
        }

        function openAccountModal() {
            document.getElementById('accountModal').classList.remove('hidden');
            updateAuthUI();
        }

        function closeAccountModal() {
            document.getElementById('accountModal').classList.add('hidden');
            // Reset form
            document.getElementById('authEmail').value = '';
            document.getElementById('authPassword').value = '';
            document.getElementById('authName').value = '';
            document.getElementById('authError').classList.add('hidden');
            authState.isSignUpMode = false;
            updateAuthFormUI();
        }

        function toggleAuthMode() {
            authState.isSignUpMode = !authState.isSignUpMode;
            updateAuthFormUI();
        }

        function updateAuthFormUI() {
            const nameField = document.getElementById('authNameField');
            const submitBtn = document.getElementById('authSubmitBtn');
            const toggleBtn = document.getElementById('authToggleBtn');
            
            if (authState.isSignUpMode) {
                nameField.classList.remove('hidden');
                submitBtn.textContent = 'Create Account';
                toggleBtn.textContent = 'Already have an account? Sign In';
            } else {
                nameField.classList.add('hidden');
                submitBtn.textContent = 'Sign In';
                toggleBtn.textContent = "Don't have an account? Sign Up";
            }
        }

        function handleAuth() {
            const email = document.getElementById('authEmail').value.trim();
            const password = document.getElementById('authPassword').value;
            const name = document.getElementById('authName').value.trim();
            const errorEl = document.getElementById('authError');
            
            // Validation
            if (!email || !password) {
                errorEl.textContent = 'Please fill in all fields';
                errorEl.classList.remove('hidden');
                return;
            }

            if (!email.includes('@')) {
                errorEl.textContent = 'Please enter a valid email';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password.length < 6) {
                errorEl.textContent = 'Password must be at least 6 characters';
                errorEl.classList.remove('hidden');
                return;
            }

            const accounts = JSON.parse(localStorage.getItem('learnBoardsAccounts') || '{}');

            if (authState.isSignUpMode) {
                // Sign Up
                if (!name) {
                    errorEl.textContent = 'Please enter your name';
                    errorEl.classList.remove('hidden');
                    return;
                }

                if (accounts[email]) {
                    errorEl.textContent = 'An account with this email already exists';
                    errorEl.classList.remove('hidden');
                    return;
                }

                // Create account
                accounts[email] = {
                    name: name,
                    password: btoa(password), // Simple encoding (not secure, just for demo)
                    createdAt: new Date().toISOString()
                };
                localStorage.setItem('learnBoardsAccounts', JSON.stringify(accounts));

                // Save current progress to this account
                saveUserData(email);

                // Sign in
                authState.isSignedIn = true;
                authState.user = { email, name };
                localStorage.setItem('learnBoardsAuth', JSON.stringify({ email, name }));
                
                showToast('Account created successfully! üéâ');
            } else {
                // Sign In
                if (!accounts[email]) {
                    errorEl.textContent = 'No account found with this email';
                    errorEl.classList.remove('hidden');
                    return;
                }

                if (accounts[email].password !== btoa(password)) {
                    errorEl.textContent = 'Incorrect password';
                    errorEl.classList.remove('hidden');
                    return;
                }

                // Load user data
                loadUserData(email);

                // Sign in
                authState.isSignedIn = true;
                authState.user = { email, name: accounts[email].name };
                localStorage.setItem('learnBoardsAuth', JSON.stringify({ email, name: accounts[email].name }));
                
                showToast('Welcome back! üëã');
            }

            updateAuthUI();
            closeAccountModal();
        }

        function saveUserData(email) {
            const key = 'learnBoardsData_' + email;
            localStorage.setItem(key, JSON.stringify(state));
        }

        function loadUserData(email) {
            const key = 'learnBoardsData_' + email;
            const savedData = localStorage.getItem(key);
            if (savedData) {
                state = { ...state, ...JSON.parse(savedData) };
                // Re-render everything
                initChapters();
                initBoardPapers();
                renderChapters();
                renderBoardPapers();
                updateDaysLeft();
                updateProgress();
                updateWeeklyChart();
                updateRecentSessions();
                updateTodayStats();
                checkStreak();
                if (state.mathsLoad) {
                    setMathsLoad(state.mathsLoad);
                }
                if (state.theme) {
                    applyTheme(state.theme);
                }
            }
        }

        function syncData() {
            if (authState.isSignedIn) {
                saveUserData(authState.user.email);
                showToast('Progress synced! ‚òÅÔ∏è');
            }
        }

        function signOut() {
            // Save current data before signing out
            if (authState.isSignedIn) {
                saveUserData(authState.user.email);
            }
            
            authState.isSignedIn = false;
            authState.user = null;
            localStorage.removeItem('learnBoardsAuth');
            
            updateAuthUI();
            closeAccountModal();
            showToast('Signed out successfully');
        }

        // ==================== SUBJECT SELECTION ====================
        function enterSubject(subject) {
            if (subject === 'science') {
                document.getElementById('subjectSelectionPage').classList.add('hidden');
                document.getElementById('scienceApp').classList.remove('hidden');
                localStorage.setItem('selectedSubject', 'science');
            }
        }

        function goToSubjectSelection() {
            document.getElementById('scienceApp').classList.add('hidden');
            document.getElementById('subjectSelectionPage').classList.remove('hidden');
            localStorage.removeItem('selectedSubject');
        }

        function checkSavedSubject() {
            const saved = localStorage.getItem('selectedSubject');
            if (saved === 'science') {
                enterSubject('science');
            }
        }

        // ==================== INITIALIZATION ====================
        function init() {
            loadAuthState();
            checkSavedSubject();
            loadState();
            initChapters();
            initBoardPapers();
            renderChapters();
            renderBoardPapers();
            updateDaysLeft();
            updateProgress();
            updateWeeklyChart();
            updateRecentSessions();
            populateChapterSelect();
            checkStreak();
            
            // Set initial values
            if (state.examDate) {
                document.getElementById('examDate').value = state.examDate;
            }
            document.getElementById('maxHours').value = state.maxHours;
            document.getElementById('syllabusStatus').value = state.syllabusComplete ? 'complete' : 'incomplete';
            
            // Restore maths load
            if (state.mathsLoad) {
                setMathsLoad(state.mathsLoad);
            }
            if (state.theme) {
                applyTheme(state.theme);
            }
        }

        function initChapters() {
            if (Object.keys(state.chapters).length === 0) {
                Object.keys(CHAPTERS).forEach(subject => {
                    CHAPTERS[subject].forEach(ch => {
                        state.chapters[ch.id] = {
                            status: 'not-started',
                            ncertDone: false,
                            oswalDone: false,
                            pyqsDone: false,
                            lastPracticed: null,
                            accuracy: null,
                            topicProgress: {}
                        };
                        ch.topics.forEach(t => {
                            state.chapters[ch.id].topicProgress[t] = 'pending';
                        });
                    });
                });
                saveState();
            }
        }

        function initBoardPapers() {
            if (!state.boardPapers || Object.keys(state.boardPapers).length === 0) {
                state.boardPapers = {};
                BOARD_PAPERS.forEach(paper => {
                    state.boardPapers[paper.year] = {
                        completed: false,
                        completedDate: null
                    };
                });
                saveState();
            }
        }

        // ==================== LOCAL STORAGE ====================
        function saveState() {
            localStorage.setItem('sciencePrepState', JSON.stringify(state));
            // Also save to user account if signed in
            if (authState.isSignedIn) {
                saveUserData(authState.user.email);
            }
        }

        function loadState() {
            const saved = localStorage.getItem('sciencePrepState');
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            }
            // Ensure theme is applied if it exists in loaded state
            if (state.theme) {
                applyTheme(state.theme);
            }
        }

        // ==================== NAVIGATION ====================
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('bg-indigo-100', 'text-indigo-700');
                b.classList.add('text-slate-600', 'hover:bg-slate-100');
            });
            
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('text-slate-600', 'hover:bg-slate-100');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('bg-indigo-100', 'text-indigo-700');
        }

        // Initialize active tab styling
        document.querySelector('[data-tab="dashboard"]').classList.add('bg-indigo-100', 'text-indigo-700');

        // ==================== BOARD PAPERS TRACKER ====================
        function renderBoardPapers() {
            const container = document.getElementById('boardPapersList');
            let completedCount = 0;

            container.innerHTML = BOARD_PAPERS.map(paper => {
                const paperState = state.boardPapers[paper.year] || { completed: false, completedDate: null };
                if (paperState.completed) completedCount++;

                return `
                    <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl border ${paperState.completed ? 'border-green-200 bg-green-50' : 'border-slate-200'}">
                        <div class="flex items-center gap-4">
                            <input 
                                type="checkbox" 
                                ${paperState.completed ? 'checked' : ''} 
                                onchange="toggleBoardPaper(${paper.year})" 
                                class="w-5 h-5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer"
                            >
                            <div>
                                <span class="font-medium text-slate-800">CBSE ${paper.year}</span>
                                <span class="text-sm text-slate-500 ml-2">Science Board Paper</span>
                            </div>
                        </div>
                        <div class="text-right">
                            ${paperState.completed && paperState.completedDate ? 
                                `<span class="text-xs text-green-600">Completed ${new Date(paperState.completedDate).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' })}</span>` : 
                                '<span class="text-xs text-slate-400">Not done</span>'
                            }
                        </div>
                    </div>
                `;
            }).join('');

            // Update progress
            document.getElementById('papersCompleted').textContent = `${completedCount} / ${BOARD_PAPERS.length}`;
            document.getElementById('papersProgressBar').style.width = `${(completedCount / BOARD_PAPERS.length) * 100}%`;

            // Show/hide empty hint
            if (completedCount === 0) {
                document.getElementById('papersEmptyHint').classList.remove('hidden');
            } else {
                document.getElementById('papersEmptyHint').classList.add('hidden');
            }
        }

        function toggleBoardPaper(year) {
            if (!state.boardPapers[year]) {
                state.boardPapers[year] = { completed: false, completedDate: null };
            }

            state.boardPapers[year].completed = !state.boardPapers[year].completed;
            state.boardPapers[year].completedDate = state.boardPapers[year].completed ? new Date().toISOString() : null;

            saveState();
            renderBoardPapers();
        }

        // ==================== SETTINGS ====================
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
            // Reset error
            document.getElementById('subjectSwitchError').classList.add('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function setTheme(themeName) {
            state.theme = themeName;
            applyTheme(themeName);
        }

        function applyTheme(themeName) {
            const body = document.body;
            body.classList.remove('theme-green', 'theme-purple', 'theme-orange');
            if (themeName !== 'default') {
                body.classList.add(`theme-${themeName}`);
            }
        }

        function switchSubject(subject) {
            if (subject === 'science') {
                // Already on science, do nothing or just confirm
                document.getElementById('subjectSwitchError').classList.add('hidden');
            } else {
                // Show error for others
                document.getElementById('subjectSwitchError').classList.remove('hidden');
            }
        }

        function saveSettings() {
            state.examDate = document.getElementById('examDate').value;
            state.maxHours = parseFloat(document.getElementById('maxHours').value);
            state.syllabusComplete = document.getElementById('syllabusStatus').value === 'complete';
            saveState();
            closeSettings();
            updateDaysLeft();
            generateDailyPlan();
            showToast('Settings saved!');
        }

        function resetAllData() {
            if (confirm('This will delete all your progress. Are you sure?')) {
                localStorage.removeItem('sciencePrepState');
                localStorage.removeItem('selectedSubject');
                if (authState.isSignedIn) {
                    localStorage.removeItem('learnBoardsData_' + authState.user.email);
                }
                location.reload();
            }
        }

        // ==================== MATHS LOAD ====================
        function setMathsLoad(load) {
            state.mathsLoad = load;
            saveState();
            
            document.querySelectorAll('.maths-btn').forEach(b => {
                b.classList.remove('bg-white', 'text-indigo-700');
                b.classList.add('bg-white/20');
            });
            document.querySelector(`[data-load="${load}"]`).classList.remove('bg-white/20');
            document.querySelector(`[data-load="${load}"]`).classList.add('bg-white', 'text-indigo-700');
            
            const allocations = {
                light: { time: '2 hours', desc: 'Full Science mode: NCERT + Heavy Oswal practice' },
                medium: { time: '1.5 hours', desc: 'Balanced mode: Focused practice + quick revision' },
                heavy: { time: '45 min', desc: 'Light mode: Quick topic review + 10-15 questions only' }
            };
            
            const alloc = allocations[load];
            document.getElementById('scienceAllocation').innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-3xl font-bold">${alloc.time}</span>
                    <span class="text-sm text-white/80">‚Üí ${alloc.desc}</span>
                </div>
            `;
            
            generateDailyPlan();
        }

        // ==================== DAILY PLANNING ====================
        function generateDailyPlan() {
            if (!state.examDate) {
                document.getElementById('dailyTasks').innerHTML = `
                    <div class="p-4 bg-amber-50 border border-amber-200 rounded-xl text-amber-700">
                        <strong>‚ö†Ô∏è Set your exam date first!</strong><br>
                        <span class="text-sm">Click the settings icon in the header.</span>
                    </div>
                `;
                return;
            }

            const daysLeft = Math.ceil((new Date(state.examDate) - new Date()) / (1000 * 60 * 60 * 24));
            const timeAllocations = { light: 120, medium: 90, heavy: 45 };
            const availableTime = timeAllocations[state.mathsLoad];
            
            let priorityChapter = findPriorityChapter();
            let tasks = [];
            
            if (state.mathsLoad === 'heavy') {
                tasks.push({
                    type: 'revision',
                    desc: `Quick revision: ${priorityChapter.name}`,
                    time: '15 min',
                    resource: 'Personal Notes'
                });
                tasks.push({
                    type: 'practice',
                    desc: '10-15 MCQs from Oswal',
                    time: '25 min',
                    resource: 'Oswal Question Bank'
                });
            } else if (state.mathsLoad === 'medium') {
                const chapterState = state.chapters[priorityChapter.id];
                if (!chapterState.ncertDone) {
                    tasks.push({
                        type: 'learn',
                        desc: `NCERT reading: ${priorityChapter.name}`,
                        time: '30 min',
                        resource: 'NCERT Textbook'
                    });
                }
                tasks.push({
                    type: 'practice',
                    desc: 'Topic-wise questions from Oswal',
                    time: '40 min',
                    resource: 'Oswal Question Bank'
                });
                tasks.push({
                    type: 'review',
                    desc: 'Mark weak areas, make notes',
                    time: '20 min',
                    resource: 'Personal Notes'
                });
            } else {
                const chapterState = state.chapters[priorityChapter.id];
                if (!chapterState.ncertDone) {
                    tasks.push({
                        type: 'learn',
                        desc: `Complete NCERT: ${priorityChapter.name}`,
                        time: '45 min',
                        resource: 'NCERT Textbook'
                    });
                }
                tasks.push({
                    type: 'practice',
                    desc: 'Chapter-wise practice (20+ questions)',
                    time: '50 min',
                    resource: 'Oswal Question Bank'
                });
                tasks.push({
                    type: 'pyq',
                    desc: 'PYQs from this chapter (2020-2024)',
                    time: '35 min',
                    resource: 'Oswal PYQ Section'
                });
            }

            if (state.syllabusComplete && daysLeft <= 14 && state.mathsLoad !== 'heavy') {
                tasks.push({
                    type: 'exam',
                    desc: 'Timed sample paper section',
                    time: '30 min',
                    resource: 'Sample Papers (Exam Mode)'
                });
            }

            renderTasks(tasks);
            updateCurrentFocus(priorityChapter);
        }

        function findPriorityChapter() {
            let allChapters = [];
            Object.keys(CHAPTERS).forEach(subject => {
                CHAPTERS[subject].forEach(ch => {
                    allChapters.push({ ...ch, subject, state: state.chapters[ch.id] });
                });
            });

            allChapters.sort((a, b) => {
                const statusPriority = { 'not-started': 0, 'learning': 1, 'practicing': 2, 'mastered': 3 };
                const aPriority = statusPriority[a.state.status];
                const bPriority = statusPriority[b.state.status];
                
                if (aPriority !== bPriority) return aPriority - bPriority;
                if (a.state.accuracy !== b.state.accuracy) {
                    return (a.state.accuracy || 0) - (b.state.accuracy || 0);
                }
                return (a.state.lastPracticed || 0) - (b.state.lastPracticed || 0);
            });

            return allChapters[0];
        }

        function renderTasks(tasks) {
            const container = document.getElementById('dailyTasks');
            const todayKey = new Date().toDateString();
            const completedTasks = JSON.parse(localStorage.getItem('completedTasks_' + todayKey) || '[]');
            
            container.innerHTML = tasks.map((task, idx) => {
                const isComplete = completedTasks.includes(idx);
                const typeIcons = { learn: 'üìñ', practice: '‚úèÔ∏è', revision: 'üîÑ', review: 'üìù', pyq: 'üìú', exam: 'üìã' };
                return `
                    <div class="flex items-start gap-3 p-4 ${isComplete ? 'bg-green-50 border-green-200' : 'bg-slate-50'} border rounded-xl ${isComplete ? 'task-complete' : ''}">
                        <input type="checkbox" ${isComplete ? 'checked' : ''} onchange="toggleTask(${idx})" class="mt-1 w-5 h-5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span>${typeIcons[task.type] || 'üìå'}</span>
                                <span class="font-medium text-slate-800">${task.desc}</span>
                            </div>
                            <div class="flex items-center gap-4 mt-1 text-sm text-slate-500">
                                <span>‚è±Ô∏è ${task.time}</span>
                                <span>üìö ${task.resource}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleTask(idx) {
            const todayKey = new Date().toDateString();
            let completedTasks = JSON.parse(localStorage.getItem('completedTasks_' + todayKey) || '[]');
            
            if (completedTasks.includes(idx)) {
                completedTasks = completedTasks.filter(i => i !== idx);
            } else {
                completedTasks.push(idx);
            }
            
            localStorage.setItem('completedTasks_' + todayKey, JSON.stringify(completedTasks));
            generateDailyPlan();
        }

        function updateCurrentFocus(chapter) {
            const subjectColors = {
                physics: 'blue',
                chemistry: 'green',
                biology: 'purple'
            };
            const color = subjectColors[chapter.subject];
            const chState = state.chapters[chapter.id];
            
            document.getElementById('currentFocus').innerHTML = `
                <div class="p-4 bg-${color}-50 border-2 border-${color}-200 rounded-xl">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-bold text-${color}-800">${chapter.name}</h4>
                        <span class="text-xs px-2 py-1 bg-${color}-200 text-${color}-800 rounded-full">${chapter.subject.charAt(0).toUpperCase() + chapter.subject.slice(1)}</span>
                    </div>
                    <div class="flex flex-wrap gap-2 mb-3">
                        <span class="text-xs px-2 py-1 ${chState.ncertDone ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'} rounded-full">
                            ${chState.ncertDone ? '‚úì' : '‚óã'} NCERT
                        </span>
                        <span class="text-xs px-2 py-1 ${chState.oswalDone ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'} rounded-full">
                            ${chState.oswalDone ? '‚úì' : '‚óã'} Oswal
                        </span>
                        <span class="text-xs px-2 py-1 ${chState.pyqsDone ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'} rounded-full">
                            ${chState.pyqsDone ? '‚úì' : '‚óã'} PYQs
                        </span>
                    </div>
                    <div class="text-sm text-${color}-700">
                        <strong>Topics:</strong> ${chapter.topics.join(', ')}
                    </div>
                </div>
            `;
        }

        // ==================== CHAPTERS ====================
        function renderChapters() {
            Object.keys(CHAPTERS).forEach(subject => {
                const container = document.getElementById(`${subject}Chapters`);
                container.innerHTML = CHAPTERS[subject].map(ch => {
                    const chState = state.chapters[ch.id];
                    const statusColors = {
                        'not-started': 'bg-slate-100 text-slate-600',
                        'learning': 'bg-amber-100 text-amber-700',
                        'practicing': 'bg-blue-100 text-blue-700',
                        'mastered': 'bg-green-100 text-green-700'
                    };
                    const statusLabels = {
                        'not-started': 'Not Started',
                        'learning': 'Learning',
                        'practicing': 'Practicing',
                        'mastered': 'Mastered'
                    };
                    return `
                        <div onclick="openChapterModal('${subject}', '${ch.id}')" class="p-3 bg-white rounded-lg cursor-pointer hover:shadow-md transition border">
                            <div class="flex items-center justify-between">
                                <span class="font-medium text-sm text-slate-800">${ch.name}</span>
                            </div>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="text-xs px-2 py-0.5 rounded-full ${statusColors[chState.status]}">${statusLabels[chState.status]}</span>
                                ${chState.accuracy !== null ? `<span class="text-xs text-slate-500">${chState.accuracy}% acc</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            });
        }

        function openChapterModal(subject, chapterId) {
            const chapter = CHAPTERS[subject].find(c => c.id === chapterId);
            const chState = state.chapters[chapterId];
            const subjectColors = { physics: 'blue', chemistry: 'green', biology: 'purple' };
            const color = subjectColors[subject];
            
            const modal = document.getElementById('chapterModal');
            const content = document.getElementById('chapterModalContent');
            
            content.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="text-xs px-2 py-1 bg-${color}-100 text-${color}-700 rounded-full">${subject.charAt(0).toUpperCase() + subject.slice(1)}</span>
                            <h3 class="font-bold text-xl text-slate-800 mt-2">${chapter.name}</h3>
                        </div>
                        <button onclick="closeChapterModal()" class="text-slate-400 hover:text-slate-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-2">Chapter Status</label>
                            <select onchange="updateChapterStatus('${chapterId}', this.value)" class="w-full p-3 border rounded-xl">
                                <option value="not-started" ${chState.status === 'not-started' ? 'selected' : ''}>Not Started</option>
                                <option value="learning" ${chState.status === 'learning' ? 'selected' : ''}>Learning (NCERT phase)</option>
                                <option value="practicing" ${chState.status === 'practicing' ? 'selected' : ''}>Practicing (Oswal phase)</option>
                                <option value="mastered" ${chState.status === 'mastered' ? 'selected' : ''}>Mastered</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-3">
                            <label class="flex items-center gap-2 p-3 bg-slate-50 rounded-xl cursor-pointer">
                                <input type="checkbox" ${chState.ncertDone ? 'checked' : ''} onchange="toggleChapterFlag('${chapterId}', 'ncertDone')" class="w-4 h-4 text-indigo-600 rounded">
                                <span class="text-sm">NCERT Done</span>
                            </label>
                            <label class="flex items-center gap-2 p-3 bg-slate-50 rounded-xl cursor-pointer">
                                <input type="checkbox" ${chState.oswalDone ? 'checked' : ''} onchange="toggleChapterFlag('${chapterId}', 'oswalDone')" class="w-4 h-4 text-indigo-600 rounded">
                                <span class="text-sm">Oswal Done</span>
                            </label>
                            <label class="flex items-center gap-2 p-3 bg-slate-50 rounded-xl cursor-pointer">
                                <input type="checkbox" ${chState.pyqsDone ? 'checked' : ''} onchange="toggleChapterFlag('${chapterId}', 'pyqsDone')" class="w-4 h-4 text-indigo-600 rounded">
                                <span class="text-sm">PYQs Done</span>
                            </label>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-medium text-slate-600 mb-2">Topics</h4>
                            <div class="flex flex-wrap gap-2">
                                ${chapter.topics.map(t => {
                                    const topicState = chState.topicProgress[t] || 'pending';
                                    const topicColors = { pending: 'bg-slate-100 text-slate-600', done: 'bg-green-100 text-green-700', weak: 'bg-red-100 text-red-700' };
                                    return `
                                        <button onclick="cycleTopicStatus('${chapterId}', '${t}')" class="text-xs px-3 py-1.5 rounded-full ${topicColors[topicState]} hover:opacity-80 transition">
                                            ${topicState === 'done' ? '‚úì' : topicState === 'weak' ? '!' : '‚óã'} ${t}
                                        </button>
                                    `;
                                }).join('')}
                            </div>
                            <p class="text-xs text-slate-400 mt-2">Click to cycle: pending ‚Üí done ‚Üí weak ‚Üí pending</p>
                        </div>
                        
                        ${chState.accuracy !== null ? `
                            <div class="p-4 bg-slate-50 rounded-xl">
                                <div class="flex justify-between">
                                    <span class="text-sm text-slate-600">Last Accuracy</span>
                                    <span class="font-bold text-slate-800">${chState.accuracy}%</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeChapterModal() {
            document.getElementById('chapterModal').classList.add('hidden');
        }

        function updateChapterStatus(chapterId, status) {
            state.chapters[chapterId].status = status;
            saveState();
            renderChapters();
            updateProgress();
        }

        function toggleChapterFlag(chapterId, flag) {
            state.chapters[chapterId][flag] = !state.chapters[chapterId][flag];
            saveState();
            renderChapters();
        }

        function cycleTopicStatus(chapterId, topic) {
            const current = state.chapters[chapterId].topicProgress[topic];
            const cycle = { pending: 'done', done: 'weak', weak: 'pending' };
            state.chapters[chapterId].topicProgress[topic] = cycle[current];
            saveState();
            let subject = '';
            Object.keys(CHAPTERS).forEach(s => {
                if (CHAPTERS[s].find(c => c.id === chapterId)) subject = s;
            });
            openChapterModal(subject, chapterId);
            updateWeakTopics();
        }

        // ==================== TIMER ====================
        function setTimer(minutes) {
            timerState.duration = minutes * 60;
            timerState.remaining = minutes * 60;
            updateTimerDisplay();
        }

        function startTimer() {
            if (timerState.running) return;
            timerState.running = true;
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');
            
            timerState.interval = setInterval(() => {
                timerState.remaining--;
                updateTimerDisplay();
                
                if (timerState.remaining <= 0) {
                    pauseTimer();
                    playNotification();
                    showToast('‚è∞ Time\'s up! Log your session.');
                }
            }, 1000);
        }

        function pauseTimer() {
            timerState.running = false;
            clearInterval(timerState.interval);
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
        }

        function resetTimer() {
            pauseTimer();
            timerState.remaining = timerState.duration;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const mins = Math.floor(timerState.remaining / 60);
            const secs = timerState.remaining % 60;
            document.getElementById('timerDisplay').textContent = 
                `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function playNotification() {
            try {
                const audio = new AudioContext();
                const oscillator = audio.createOscillator();
                oscillator.connect(audio.destination);
                oscillator.frequency.value = 800;
                oscillator.start();
                setTimeout(() => oscillator.stop(), 200);
            } catch (e) {}
        }

        // ==================== SESSION LOGGING ====================
        function populateChapterSelect() {
            const select = document.getElementById('sessionChapter');
            select.innerHTML = '<option value="">Select Chapter</option>';
            
            Object.keys(CHAPTERS).forEach(subject => {
                const group = document.createElement('optgroup');
                group.label = subject.charAt(0).toUpperCase() + subject.slice(1);
                CHAPTERS[subject].forEach(ch => {
                    const opt = document.createElement('option');
                    opt.value = ch.id;
                    opt.textContent = ch.name;
                    group.appendChild(opt);
                });
                select.appendChild(group);
            });
        }

        document.getElementById('sessionActivity').addEventListener('change', function() {
            const tips = {
                ncert: { 
                    tip: 'üìñ NCERT is for first-time learning only. Read actively with a pen. Make margin notes.',
                    warning: state.chapters[document.getElementById('sessionChapter').value]?.ncertDone ? 
                        '‚ö†Ô∏è You\'ve already completed NCERT for this chapter. Use Oswal for practice instead.' : null
                },
                oswal: { 
                    tip: '‚úèÔ∏è Focus on understanding solutions, not just answers. Mark questions you got wrong.',
                    warning: null 
                },
                pyq: { 
                    tip: 'üìú Treat these like real exams. Time yourself. Check marking scheme from SuperCoP.',
                    warning: null 
                },
                revision: { 
                    tip: 'üîÑ Quick review only. If a concept is unclear, go back to Oswal practice, not NCERT.',
                    warning: !state.chapters[document.getElementById('sessionChapter').value]?.ncertDone ? 
                        '‚ö†Ô∏è Complete NCERT first before revision. Notes are not for first-time learning.' : null
                },
                sample: { 
                    tip: 'üìã Exam mode only! No references. Time strictly. This is for self-evaluation.',
                    warning: !state.syllabusComplete ? 
                        '‚ö†Ô∏è Sample papers should only be used after completing the full syllabus once.' : null
                }
            };
            
            const selected = tips[this.value];
            document.getElementById('resourceTip').innerHTML = `<strong>üí° Tip:</strong> ${selected.tip}`;
            
            if (selected.warning) {
                document.getElementById('resourceWarning').innerHTML = selected.warning;
                document.getElementById('resourceWarning').classList.remove('hidden');
            } else {
                document.getElementById('resourceWarning').classList.add('hidden');
            }
        });

        function logSession() {
            const chapter = document.getElementById('sessionChapter').value;
            const activity = document.getElementById('sessionActivity').value;
            const attempted = parseInt(document.getElementById('questionsAttempted').value) || 0;
            const correct = parseInt(document.getElementById('questionsCorrect').value) || 0;
            const difficulty = document.getElementById('difficultyLevel').value;
            
            if (!chapter) {
                showToast('Please select a chapter');
                return;
            }

            const timeSpent = timerState.duration - timerState.remaining;
            const accuracy = attempted > 0 ? Math.round((correct / attempted) * 100) : null;

            const session = {
                date: new Date().toISOString(),
                chapter,
                activity,
                attempted,
                correct,
                accuracy,
                difficulty,
                timeSpent: Math.round(timeSpent / 60)
            };

            state.sessions.push(session);
            
            if (activity === 'ncert') state.chapters[chapter].ncertDone = true;
            if (activity === 'oswal') state.chapters[chapter].oswalDone = true;
            if (activity === 'pyq') state.chapters[chapter].pyqsDone = true;
            
            if (accuracy !== null) {
                state.chapters[chapter].accuracy = accuracy;
            }
            state.chapters[chapter].lastPracticed = Date.now();

            if (state.chapters[chapter].ncertDone && state.chapters[chapter].status === 'not-started') {
                state.chapters[chapter].status = 'learning';
            }
            if (state.chapters[chapter].oswalDone) {
                state.chapters[chapter].status = 'practicing';
            }
            if (state.chapters[chapter].ncertDone && state.chapters[chapter].oswalDone && state.chapters[chapter].pyqsDone && accuracy >= 80) {
                state.chapters[chapter].status = 'mastered';
            }

            const today = new Date().toDateString();
            if (state.lastStudyDate !== today) {
                state.todayStats = { time: 0, questions: 0, correct: 0 };
            }
            state.todayStats.time += Math.round(timeSpent / 60);
            state.todayStats.questions += attempted;
            state.todayStats.correct += correct;
            state.lastStudyDate = today;

            saveState();
            resetTimer();
            document.getElementById('questionsAttempted').value = 0;
            document.getElementById('questionsCorrect').value = 0;
            
            updateProgress();
            updateRecentSessions();
            updateWeeklyChart();
            updateTodayStats();
            updateWeakTopics();
            renderChapters();
            checkStreak();
            
            showToast('Session logged successfully! üéâ');
        }

        // ==================== PROGRESS TRACKING ====================
        function updateProgress() {
            let completed = 0;
            Object.keys(state.chapters).forEach(id => {
                if (state.chapters[id].status === 'mastered') completed++;
            });

            const percent = Math.round((completed / 13) * 100);
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('chaptersComplete').textContent = completed;
            
            const ring = document.getElementById('progressRing');
            const offset = 251.2 - (251.2 * percent / 100);
            ring.style.strokeDashoffset = offset;

            Object.keys(CHAPTERS).forEach(subject => {
                let subjectComplete = 0;
                CHAPTERS[subject].forEach(ch => {
                    if (state.chapters[ch.id].status === 'mastered') subjectComplete++;
                });
                const subjectPercent = Math.round((subjectComplete / CHAPTERS[subject].length) * 100);
                document.getElementById(`${subject}Progress`).textContent = subjectPercent + '%';
                document.getElementById(`${subject}Bar`).style.width = subjectPercent + '%';
            });
        }

        function updateDaysLeft() {
            if (!state.examDate) {
                document.getElementById('daysLeft').textContent = '--';
                return;
            }
            const days = Math.ceil((new Date(state.examDate) - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('daysLeft').textContent = days > 0 ? days : 0;
        }

        function updateTodayStats() {
            const today = new Date().toDateString();
            if (state.lastStudyDate === today) {
                document.getElementById('todayStudyTime').textContent = state.todayStats.time + ' min';
                document.getElementById('todayQuestions').textContent = state.todayStats.questions;
                const acc = state.todayStats.questions > 0 ? 
                    Math.round((state.todayStats.correct / state.todayStats.questions) * 100) : 0;
                document.getElementById('todayAccuracy').textContent = acc + '%';
            }
        }

        function updateWeeklyChart() {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const container = document.getElementById('weeklyChart');
            const today = new Date();
            
            container.innerHTML = '';
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const daySessions = state.sessions.filter(s => 
                    new Date(s.date).toDateString() === dateStr
                );
                const totalTime = daySessions.reduce((sum, s) => sum + (s.timeSpent || 0), 0);
                const height = Math.min(100, (totalTime / 120) * 100);
                
                container.innerHTML += `
                    <div class="text-center">
                        <div class="h-24 bg-slate-100 rounded-lg relative overflow-hidden">
                            <div class="absolute bottom-0 w-full bg-indigo-500 rounded-lg transition-all" style="height: ${height}%"></div>
                        </div>
                        <p class="text-xs text-slate-500 mt-1">${days[date.getDay()]}</p>
                        <p class="text-xs font-medium text-slate-700">${totalTime}m</p>
                    </div>
                `;
            }
        }

        function updateRecentSessions() {
            const container = document.getElementById('recentSessions');
            const recent = state.sessions.slice(-10).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-sm">No sessions logged yet</p>';
                return;
            }

            container.innerHTML = recent.map(s => {
                const chapter = Object.keys(CHAPTERS).flatMap(sub => 
                    CHAPTERS[sub].map(c => ({ ...c, subject: sub }))
                ).find(c => c.id === s.chapter);
                
                const activityLabels = { ncert: 'üìñ NCERT', oswal: '‚úèÔ∏è Oswal', pyq: 'üìú PYQ', revision: 'üîÑ Revision', sample: 'üìã Sample' };
                const date = new Date(s.date).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
                
                return `
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                        <div>
                            <span class="font-medium text-slate-800">${chapter?.name || s.chapter}</span>
                            <div class="text-sm text-slate-500">${activityLabels[s.activity] || s.activity} ‚Ä¢ ${date}</div>
                        </div>
                        <div class="text-right">
                            <span class="font-bold text-slate-800">${s.accuracy !== null ? s.accuracy + '%' : '-'}</span>
                            <div class="text-xs text-slate-500">${s.attempted} Q ‚Ä¢ ${s.timeSpent}m</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateWeakTopics() {
            const container = document.getElementById('weakTopics');
            let weakAreas = [];

            Object.keys(state.chapters).forEach(chId => {
                const ch = state.chapters[chId];
                Object.keys(ch.topicProgress).forEach(topic => {
                    if (ch.topicProgress[topic] === 'weak') {
                        const chapterData = Object.keys(CHAPTERS).flatMap(s => CHAPTERS[s]).find(c => c.id === chId);
                        weakAreas.push({ chapter: chapterData?.name || chId, topic });
                    }
                });
                
                if (ch.accuracy !== null && ch.accuracy < 60) {
                    const chapterData = Object.keys(CHAPTERS).flatMap(s => CHAPTERS[s]).find(c => c.id === chId);
                    if (!weakAreas.find(w => w.chapter === chapterData?.name)) {
                        weakAreas.push({ chapter: chapterData?.name || chId, topic: 'Overall (low accuracy)' });
                    }
                }
            });

            if (weakAreas.length === 0) {
                container.innerHTML = '<p class="text-red-600 text-sm">No weak areas identified yet. Keep practicing!</p>';
                return;
            }

            container.innerHTML = weakAreas.map(w => `
                <div class="p-3 bg-white rounded-lg border border-red-200">
                    <span class="font-medium text-red-800">${w.chapter}</span>
                    <p class="text-sm text-red-600">${w.topic}</p>
                </div>
            `).join('');
        }

        function checkStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            if (state.lastStudyDate === today) {
            } else if (state.lastStudyDate === yesterday) {
            } else if (state.lastStudyDate) {
                state.streak = 0;
            }
            
            if (state.lastStudyDate === today && state.streak === 0) {
                state.streak = 1;
            }
            
            let streak = 0;
            let checkDate = new Date();
            while (true) {
                const dateStr = checkDate.toDateString();
                const hasSession = state.sessions.some(s => new Date(s.date).toDateString() === dateStr);
                if (hasSession) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else if (checkDate.toDateString() === today) {
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            state.streak = streak;
            document.getElementById('streakCount').textContent = streak + ' day' + (streak !== 1 ? 's' : '');
            saveState();
        }

        // ==================== UTILITIES ====================
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Initialize
        init();
        updateTodayStats();
    </script>
</body>
</html>